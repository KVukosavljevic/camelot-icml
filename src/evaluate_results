#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Sun Jan 16 23:15:46 2022

@author: henrique.aguiar@ds.ccrg.kadooriecentre.org
"""

   
# ------------------------------------------------------------------------------
"""Finally, print some basic statistics for analysing this run"""
y_true = y_test
y_pred = y_pred.values
auc, f1, rec, pur = utils.super_scores(y_true, y_pred)
sil, sil_avg, dbi, dbi_avg, vri, vri_avg = utils.unsuper_scores(X_test, clusters_pred)

print("Supervised Performance:", f"AUC: {auc:.2f}", f"f1: {f1:.2f}", f"rec: {rec:.2f}", f"pur: {pur:.2f}", sep = "\n")
print("Unsupervised Scores:", f"SIL: {sil:.2f}, {sil_avg:.2f}", f"DBI: {dbi:.2f}, {dbi_avg:.2f}", 
      f"vri: {vri:.2f} {vri_avg:.2f}", sep = "\n")

cluster_dist = pd.Series(data=0, index=cluster_names)
for clus in cluster_names:
    cluster_dist.loc[clus] = np.sum(clusters_pred==clus)

print("Cluster Assignment distribution: ", cluster_dist, sep = "\n")
print("Num Clusters with patients: {}".format(np.sum(cluster_dist != 0)))




# ------------------------------------------------------------------------------
"""Add configuration information and scores to a master excel file."""
run_ids = [time.time(), run_num]
results = [auc, f1, rec, pur, sil, sil_avg, dbi, dbi_avg, vri, vri_avg]
param_names, param_values = vars(params).keys(), vars(params).values()

if not os.path.exists(TRACK_FD + "summary.csv"):
    with open(TRACK_FD + "summary.csv", "w+", newline = "") as f:
        writer = csv.writer(f)
        writer.writerow(["time (unix)", "run"] + list(param_names) + ["auc", "f1", "recall", "purity",
                         "sil", "sil_avg", "dbi", "dbi_avg", "vri", "vri_avg"])
        
    f.close()
    
with open(TRACK_FD + "summary.csv", "a", newline = "") as f:
    writer = csv.writer(f)
    
    new_row = [time.time(), run_num] + list(param_values) + [auc, f1, rec, pur, sil, sil_avg, dbi, dbi_avg, vri, vri_avg]
    writer.writerow(new_row)
    
    f.close()
   
np.savez("data/ICLR-submitted/test_data.npz", 
         X_test=X_test, y_test=y_test, id_test=id_test, mask_test=mask_test,
         X_og=X_og, y_og=y_og, feats=feats)